<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link rel="stylesheet" href="./css/1.12.x/jquery-ui.css">
  <link rel="stylesheet" href="./css/style.css">
</head>
<body>
  <h1>JSでインタラクティブアートにチャレンジ</h1>
  <div>
    <table>
      <tbody>
        <tr>
          <!-- ローカルファイルを読み込むためのボタンを設置 -->
          <td>ファイルの指定</td>
          <td><input type="file" id="file"></td>
        </tr>
        <tr>
          <!-- 明るさを変更するためのレンジを設置 -->
          <td colspan="">明るさ</td>
          <td colspan="2"><input type="range" max="127" min="-127" step="1" value="0" id="brightness"><input id="brightness_number" type="number" max="127" min="-127" step="1" value="0"></td>
        </tr>
        <tr>
          <!-- ダウンロードするためのリンクを設置 -->
          <td><a href="javascript: void 0;" id="download" download="download.png">ダウンロード</a></td>
          <!-- リセットリンクを設置 -->
          <td><a href="javascript: void 0;" onclick="reset()">リセット</a></td>
        </tr>
      </tbody>
    </table>
  </div>
  <div>
    <table>
      <tbody>
        <tr>
          <td>
            <!-- 画像を描画するキャンバスを設置 -->
            <canvas id="canvas"></canvas>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <script src="./js/1.12.x/jquery-1.12.4.js"></script>
  <script src="./js/1.12.x/jquery-ui.js"></script>
  <script type="text/javascript">
    //グローバルスコープに必要な変数を定義
    var context = null;
    var img = new Image();
    var width = null;
    var height = null;
    var defaultPixelsData = null;
    //画面ロード時の初期化処理
    $(function() {
      //canvas(canvas)のノードオブジェクトを取得
      var canvas = $('#canvas')[0];
      //キャンバスサイズの指定
      canvas.width = 300;
      canvas.height = 300;
      //キャンパスのサイズをグローバルに保存
      width = canvas.width;
      height = canvas.height;
      //2Dコンテキストをグローバルに保存
      context = canvas.getContext('2d');
      //ファイルの参照ボタンのチェンジイベントを定義
      $('#file').change(function(evt) {
        var file = evt.target.files;
        var reader = new FileReader();
        reader.readAsDataURL(file[0]);
        reader.onload = function() {
          img.src = reader.result;
        };
      });
      //画像のロードイベントを定義
      $(img).load(
          function() {
            context.drawImage(img, 0, 0, width, height);
            if (!defaultPixelsData) {
              defaultPixelsData = context.getImageData(0, 0,
                  width, height);
            }
          });
      //start この部分に追記
      //end この部分に追記
    });
    //start この部分に追記
    //end この部分に追記
  </script>
</body>
</html>
